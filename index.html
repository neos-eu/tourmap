<!DOCTYPE html>
<html>
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta http-equiv="refresh" content="300">
    <meta charset="utf-8">
    <meta property="og:image" content="https://ichtuwas.neos.eu/hubfs/Kampagnen/NRW17/Wahltour%2036Neos/assets/preview.png" />
    {{ standard_header_includes }}
    <script src="https://code.jquery.com/jquery-latest.min.js"
            type="text/javascript"></script>
    <style>

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: "Open Sans";
        }

        #map-container {
            height: 100%;
            /* overflow: hidden; */
        }

        #map {
            height: 100%;
        }

        #countdown-overlay {
            position:absolute;
            display:table;
            top:0px;
            left:0px;
            z-index:99;
            background-color:rgba(255,255,255,0.5);

            width:100%;
            height:100%;
        }

        #countdown-overlay .overlay-middle {
            vertical-align:middle;
            display:table-cell;
        }

        #countdown-overlay h2 {
            font-size:72pt;
            font-family: 'montserrat', Verdana;
            font-weight: 700;
            color: #e84188;
            margin: 0;
        }

        .overlay-inner {
            text-align:center;
        }

        @media (max-width: 768px){
            #map-container {
                height: auto;
            }

            #map {
                height: 76vh;
            }

            #countdown-overlay {
                position: static;
                height: auto;
                opacity: 1.0;
            }

            #countdown-overlay h2 {
                font-size: 36pt;
            }

            .overlay-inner p {
                margin: 0 10px;
            }
        }

        @media (min-width: 768px){
            .overlay-middle div p {
                width:500px;
                margin: 0 auto;
                font-size:16pt;
            }
        }

        #markerLayer img {
            animation: pulse 2.0s infinite alternate;
            -webkit-animation: pulse 2.0s infinite alternate;
            transition-timing-function: linear;
            -webkit-transition-timing-function: linear;
            transform-origin: center;
            -webkit-transform-origin: center;
        }

        /* Animaitons */
        @keyframes pulse{
            to {
                transform: scale(0.8);
                -webkit-transform: scale(0.8);
            }
        }

        @-webkit-keyframes pulse{
            to {
                transform: scale(0.8);
                -webkit-transform: scale(0.8);
            }
        }

        .map-box {
            width: 200px;
        }

        .map-box h2 {
            margin: 0;
        }

        .map-box-date {
            font-weight: 700;
        }

        .map-box-description {
            margin-top: 10px;
        }

    </style>
</head>
<body>
<div id="map-container">
    <div id="map"></div>
    <div id="countdown-overlay" style="display:none">
        <div class="overlay-middle">
            <div class="overlay-inner">
                <div id="countdown"></div>
                <p>Der längste Wahlabschluss Österreichs. Sei live dabei, wenn Matthias Strolz und Irmgard Griss ab Donnerstag Abend 36 Stunden lang auf Tour gehen und Menschen in ganz Österreich treffen.</p
            </div>
        </div>
    </div>
</div>
<div id="debug-output"></div>
<script>




    //var imagePathPrefix = "";
    var imagePathPrefix = "https://ichtuwas.neos.eu/hubfs/Kampagnen/NRW17/Wahltour%2036Neos/assets/";
    var imagePathBubble = imagePathPrefix + "bubble32px.png";
    var imagePathStrolz = imagePathPrefix + "strolz.png";
    var imagePathGriss = imagePathPrefix + "griss.png";
    var imagePathGrissStrolz = imagePathPrefix + "grissstrolz.png";
    var imagePathFlag = imagePathPrefix + "flag1.png";
    var imagePathFlagChallenge = imagePathPrefix + "flag2.png";
    var imagePathFlagGoal = imagePathPrefix + "flag3.png";
    var imagePathInfo = imagePathPrefix + "info.png";

    var simulateTour = true;
    var simulationStartRealTime = new Date();
    var simulatedTourStartDate = new Date(2017,9,12,1,0,0,0);
    var simulatedTourEndDate = new Date(2017,9,14,20,0,0,0);
    const simulationTimeMultiplier = 60 * 60 * 3;


    var updateInterval = 1000;
    if(simulateTour){
        updateInterval = 20;
    }


    function getNow(){
        var now = new Date();
        if(simulateTour){
            var diff = now - simulationStartRealTime;
            diff *= simulationTimeMultiplier;
            if(diff > simulatedTourEndDate - simulatedTourStartDate){
                simulationStartRealTime = new Date();
            }

            var newDateMilliseconds = simulatedTourStartDate.getTime() + diff;
            var result = new Date(newDateMilliseconds);
            return result;
        }
        else {
            return now;
        }
    }

    var map;
    function initMap() {

        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 47.6746209, lng: 13.5},
            zoom: 8,
            draggable: false,
            minZoom: 0
        });

        //                                                                                                              Focus

        var refocus = function(){
            var bounds = new google.maps.LatLngBounds(
                    new google.maps.LatLng(46.373874, 9.533314),
                    new google.maps.LatLng(49.012635, 17.160764)
            );
            map.fitBounds(bounds);
        };

        refocus();

        $(window).resize(function(){
            //var center = map.getCenter();
            google.maps.event.trigger(map, "resize");
            refocus();
        });

        //                                                                                                              FUSION TABLE / COUNTRY BORDER

        var world_geometry = new google.maps.FusionTablesLayer({
            query: {
                select: 'geometry',
                from: '11fryZLw__OBjsjF8itWw-ZQimwcCzuhLKcaaozfP'
            },
            styles: [{
                polygonOptions: {
                    fillColor: "#ffffff",
                    fillOpacity: 0.2,
                    strokeColor: "#ffffff",
                    strokeOpacity: 0.2,
                    strokeWeight: 6
                }
            }
            ],
            map: map,
            suppressInfoWindows: true
        });

        //                                                                                                              CONTROLS
        /*
         // Create a div to hold the control.
         var controlDiv = document.createElement('div');

         var controlUI = document.createElement('div');
         controlUI.style.backgroundColor = '#fff';
         controlUI.style.border = '2px solid #fff';
         controlUI.style.cursor = 'pointer';
         controlUI.style.marginBottom = '22px';
         controlUI.style.textAlign = 'center';
         controlUI.style.height = "100vh";
         controlUI.title = 'Click to recenter the map';
         controlDiv.appendChild(controlUI);

         var controlText = document.createElement('div');
         controlText.style.color = 'rgb(25,25,25)';
         controlText.style.fontFamily = 'Roboto,Arial,sans-serif';
         controlText.style.fontSize = '16px';
         controlText.style.lineHeight = '38px';
         controlText.style.paddingLeft = '5px';
         controlText.style.paddingRight = '5px';
         controlText.innerHTML = 'Center Map wooop woop foooo';
         controlUI.appendChild(controlText);

         controlDiv.index = 1;
         map.controls[google.maps.ControlPosition.TOP_LEFT].push(controlDiv);

         /**/

        //                                                                                                              STYLES
        var styles = [

            {
                "featureType": "administrative",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "color": "#E84188"
                    }
                ]
            },
            {
                "featureType": "administrative.land_parcel",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": "12"
                    }
                ]
            },

            {
                "featureType": "landscape.man_made",
                "elementType": "all",
                "stylers": [
                    {
                        "color": "#E8E8E8"
                    }
                ]
            },
            {
                "featureType": "landscape.natural",
                "elementType": "all",
                "stylers": [
                    {
                        "color": "#f2f2f2"
                    }
                ]
            },

            {
                "featureType": "poi",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "poi.attraction",
                "elementType": "geometry.fill",
                "stylers": [
                    {
                        "visibility": "off"
                    },
                    {
                        "color": "#000000"
                    },
                ]
            },
            {
                "featureType": "poi.attraction",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#8F8F8F"
                    },
                ]
            },
            {
                "featureType": "poi.attraction",
                "elementType": "labels.text.stroke",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "poi.business",
                "elementType": "labels.text",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#000000"
                    }
                ]
            },
            {
                "featureType": "poi.business",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#000000"
                    }
                ]
            },
            {
                "featureType": "poi.business",
                "elementType": "labels.text.stroke",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "poi.government",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "saturation": "-100"
                    }
                ]
            },
            {
                "featureType": "poi.medical",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "saturation": "-100"
                    }
                ]
            },
            {
                "featureType": "poi.park",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "saturation": "-65"
                    },
                    {
                        "lightness": "30"
                    }
                ]
            },
            {
                "featureType": "poi.place_of_worship",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "poi.place_of_worship",
                "elementType": "labels.text",
                "stylers": [
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "poi.place_of_worship",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#8F8F8F"
                    }

                ]
            },
            {
                "featureType": "poi.place_of_worship",
                "elementType": "labels.text.stroke",
                "stylers": [
                    {
                        "visibility": "on"
                    }

                ]
            },
            {
                "featureType": "poi.place_of_worship",
                "elementType": "labels.icon",
                "stylers": [
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "poi.school",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "saturation": "-100"
                    }
                ]
            },
            {
                "featureType": "poi.sports_complex",
                "elementType": "geometry.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "saturation": "-100"
                    }
                ]
            },
            {
                "featureType": "poi.sports_complex",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#8F8F8F"
                    }
                ]
            },
            {
                "featureType": "poi.sports_complex",
                "elementType": "labels.text.stroke",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": -100
                    },
                    {
                        "lightness": 45
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "color": "#8F8F8F"
                    }
                ]
            },
            {
                "featureType": "road.highway",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "road.arterial",
                "elementType": "labels.icon",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "transit.line",
                "elementType": "geometry.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "weight": "1"
                    }
                ]
            },
            {
                "featureType": "transit.station.airport",
                "elementType": "geometry",
                "stylers": [
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "transit.station.rail",
                "elementType": "geometry.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#ff0000"
                    },
                    {
                        "weight": "1"
                    }
                ]
            },
            {
                "featureType": "transit.station.rail",
                "elementType": "labels.text",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "hue": "#ff0000"
                    }
                ]
            },
            {
                "featureType": "transit.station.rail",
                "elementType": "labels.icon",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "all",
                "stylers": [
                    {
                        "color": "#d4e4eb"
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "geometry.fill",
                "stylers": [
                    {
                        "visibility": "on"
                    },
                    {
                        "color": "#cbdae2"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "color": "#9b7f7f"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "labels.text.stroke",
                "stylers": [
                    {
                        "color": "#dfc9c9"
                    }
                ]
            }
            /*{
             "stylers": [
             {
             "hue": "#ff61a6"
             },
             {
             "visibility": "on"
             },
             {
             "invert_lightness": true
             },
             {
             "saturation": 40
             },
             {
             "lightness": 10
             }
             ]
             },*/
            /*{
             "featureType": "all",
             "stylers": [
             { "color": "#C0C0C0" }
             ]
             },*/
            /* {
             featureType: "transit",
             elements: "all",
             stylers: [
             {
             //visibility: "off",
             color: "#e84188"
             }
             ]
             },*/
        ];

        map.setOptions({styles: styles});

        //                                                                                                              GEOCODING
        /*
         var geocoder = new google.maps.Geocoder();
         var address = "Bregenz";
         geocoder.geocode({'address': address}, function(results, status) {
         if (status === 'OK') {
         var foo = results[0].geometry.location;
         var lat = foo.lat();
         var lng = foo.lng();
         resultsMap.setCenter(foo);
         var marker = new google.maps.Marker({
         map: resultsMap,
         position: results[0].geometry.location
         });
         } else {
         alert('Geocode was not successful for the following reason: ' + status);
         }
         });/**/

        //                                                                                                              SETUP: IMAGES

        var markerArray = [];

        var imageStrolz = {
            url: imagePathStrolz,
            anchor: new google.maps.Point(2,15)
        };

        var imageGriss = {
            url: imagePathGriss,
            anchor: new google.maps.Point(2,15)
        };

        var imageGrissStrolz = {
            url: imagePathGrissStrolz,
            anchor: new google.maps.Point(44,15)
        };


        var imageBubble = {
            url: imagePathBubble,
            anchor: new google.maps.Point(2,29)
        };

        var imageFlag = {
            url: imagePathFlag,
            anchor: new google.maps.Point(4,32)
        };

        var imageFlagChallenge = {
            url: imagePathFlagChallenge,
            anchor: new google.maps.Point(6,40)
        };

        var imageFlagGoal = {
            url: imagePathFlagGoal,
            anchor: new google.maps.Point(6,48)
        };

        var imageInfo = {
            url: imagePathInfo
        };

        //                                                                                                              SETUP: POSITIONS
        var position_bregenz = { // Challenge
            position: {lat: 47.50075, lng: 9.74231},
            title: "Bregenz",
            date: "Freitag, 8:30 - 9:00 Uhr",
            description: 'Matthias Strolz startet die 36-Stunden-Tour in seiner Heimat - in Vorarlberg. Sei live dabei, wenn er seine erste Chancen-Challenge antritt.'
            , image: imageFlagChallenge
        };
        var position_innsbruck = { // challenge 2
            position: {lat: 47.2692124, lng: 11.404102400000056},
            title: "Innsbruck",
            date: "Freitag, 13:15 - 15:15 Uhr",
            description: 'Zweite Station für Matthias Strolz: In Tirols Landeshauptstadt absolviert er seine zweite Chancen-Challenge.'
            , image: imageFlagChallenge
        };

        var position_graz = {
            position: {lat: 47.070714, lng: 15.439503999999943},
            title: "Graz",
            description: "Irmgard Griss' zweite Station: Ihr Heimatbundesland Steiermark."
            , image: imageFlag
        };
        var position_salzburg = {
            position: {lat: 47.80949, lng: 13.05501},
            title: "Salzburg",
            date: "Freitag, 15:45 Uhr - Samstag, 8:52",
            description: 'Matthias Strolz und Irmgard Griss treffen sich in Salzburg. Von hier aus fahren sie mit der Bahn nach Wien. Du willst dabei sein? Reserviere dir hier dein Ticket: <a href="">Ticket anmelden</a>'
            , image: imageFlag
        };
        var position_linz = { // challenge 3
            position: {lat: 48.30694, lng: 14.285830000000033},
            title: "Linz",
            date: "Samstag, 10:00 - 12:01 Uhr",
            description: 'Matthias Strolz und Irmgard Griss machen einen Zwischenstopp in Linz. Mat muss seine dritte Chancen-Challenge bestehen. Danach geht es mit der Bahn weiter nach Wien. Du willst dabei sein? Reserviere dir hier dein Ticket: <a href="">Ticket anmelden</a>'
            , image: imageFlagChallenge
        };
        var position_stpoelten = {
            position: {lat: 48.20353, lng: 15.63817},
            title: "St. Pölten",
            date: "Samstag, 12:57 Uhr",
            description: 'Bitte einsteigen! Steig ein, wenn du mit Matthias Strolz und Irmgard Griss nach Wien fahren möchtest: <a href="">Ticket anmelden</a>'
            , image: imageFlag
        };
        var position_wien = {
            position: {lat: 48.2081743, lng: 16.3738189},
            title: "Wien",
            date: "Samstag, 13:20 - 15:00 Uhr",
            description: 'Die 36-Stunden-Tour endet in Wien und wir treffen uns gemeinsam beim Wahlabschluss.'
            , image: imageFlagGoal
        };

        var infoLivestream1 = {
            position: {
                lat: position_bregenz.position.lat * 0.4 + position_innsbruck.position.lat * 0.6,
                lng: position_bregenz.position.lng * 0.4 + position_innsbruck.position.lng * 0.6
            },
            title: "Erster Livestream",
            date: "Freitag, 11:00 Uhr",
            description: "Mat war live: Link",
            image: imageInfo
        };

        var poi1 = {
            position: {
                lat: position_graz.position.lat * 0.4 + position_innsbruck.position.lat * 0.6,
                lng: position_graz.position.lng * 0.4 + position_innsbruck.position.lng * 0.6
            },
            title: "Erster Livestream",
            date: "Freitag, 11:00 Uhr",
            description: "Mat war live: Link",
            image: imageBubble
        };


        var positions = [
            position_bregenz,
            position_salzburg,
            position_graz,
            position_stpoelten,
            position_innsbruck,
            position_linz,
            position_wien,
            //infoLivestream1,
            //poi1
        ];

        var infowindow;

        var markers = [];
        //  Create markers and add logic for info window
        for(var i = 0; i < positions.length; i++){
            var marker= new google.maps.Marker({
                position: positions[i].position,
                map: map,
                //title: positions[i].title,
                icon: positions[i].image
            });

            marker.addListener('click', function() {
                if(infowindow != null){
                    infowindow.close();
                }
                infowindow = new google.maps.InfoWindow({content:this.content});
                infowindow.open(map, this);
            });

            var html =
                    '<div class="map-box"><h2>' + positions[i].title + '</h2>' +
                    '<div class="map-box-date">' + positions[i].date + "</div>" +
                    '<div class="map-box-description">' + positions[i].description + "</div>";

            marker.content = html;

            markers[i] = marker;
        }



        var lineConnections = [
            {
                source: position_graz,
                target: position_salzburg
            },
            {
                source: position_bregenz,
                target: position_innsbruck
            },
            {
                source: position_innsbruck,
                target: position_salzburg
            },
            {
                source: position_salzburg,
                target: position_linz
            },
            {
                source: position_linz,
                target: position_stpoelten
            },
            {
                source: position_stpoelten,
                target: position_wien
            },
            {
                source: position_wien,
                target: position_graz
            }
        ];


        var lineSymbol = {
            path: 'M 0,-1 0,1',
            strokeOpacity: 1,
            scale: 4
        };

        var lines = [];

        for (i = 0; i < lineConnections.length; i++) {

            var sourcePath = new google.maps.LatLng(lineConnections[i].source.position.lat, lineConnections[i].source.position.lng);
            var targetPath = new google.maps.LatLng(lineConnections[i].target.position.lat, lineConnections[i].target.position.lng);

            var line = new google.maps.Polyline({
                //
                path: [sourcePath, targetPath],
                strokeOpacity: 0.0,
                strokeWeight: 2,
                strokeColor: '#e84188',
                geodesic: true,
                icons: [{
                    icon: lineSymbol,
                    offset: '100%',
                    repeat: '30px'
                }]
            });
            line.setMap(map);
            lines.push(line);
        } //end of for loop
        // alert(lines.length);


        var animate = function() {
            var count = 0;
            offsetId = window.setInterval(function () {
                count = (count + 1) % 2000;
                for (var i = 0; i < lines.length; i++) {
                    var icons = lines[i].get('icons');
                    icons[0].offset = (count / 2) + '%';
                    lines[i].set('icons', icons);
                }
            }, 200);
        };

        animate();

        //                                                                                                              TOUR

        // Griss
        var dateStart = new Date(2017,9,10,10,45,0,0);
        dateStart.setUTCDate(11);
        dateStart.setUTCHours(4);
        dateStart.setUTCMinutes(0);

        var dateTransferWienGrazStart = new Date(2017,9,10,10,45,0,0);
        dateTransferWienGrazStart.setUTCDate(12);
        dateTransferWienGrazStart.setUTCHours(17);
        dateTransferWienGrazStart.setUTCMinutes(0);

        var dateTransferWienGrazEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferWienGrazEnd.setUTCDate(12);
        dateTransferWienGrazEnd.setUTCHours(21);
        dateTransferWienGrazEnd.setUTCMinutes(0);

        var dateTransferGrazSalzburgStart = new Date(2017,9,10,10,45,0,0);
        dateTransferGrazSalzburgStart.setUTCDate(13);
        dateTransferGrazSalzburgStart.setUTCHours(9);
        dateTransferGrazSalzburgStart.setUTCMinutes(45);

        var dateTransferGrazSalzburgEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferGrazSalzburgEnd.setUTCDate(13);
        dateTransferGrazSalzburgEnd.setUTCHours(13);
        dateTransferGrazSalzburgEnd.setUTCMinutes(44);

        //Strolz
        var dateTransferWienBregenzStart = new Date(2017,9,10,10,45,0,0);
        dateTransferWienBregenzStart.setUTCDate(12);
        dateTransferWienBregenzStart.setUTCHours(20);
        dateTransferWienBregenzStart.setUTCMinutes(15);

        var dateTransferWienBregenzEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferWienBregenzEnd.setUTCDate(13);
        dateTransferWienBregenzEnd.setUTCHours(7);
        dateTransferWienBregenzEnd.setUTCMinutes(30);

        var dateTransferBregenzInnsbruckStart = new Date(2017,9,10,13,45,0,0);
        dateTransferBregenzInnsbruckStart.setUTCDate(13);
        dateTransferBregenzInnsbruckStart.setUTCHours(8);
        dateTransferBregenzInnsbruckStart.setUTCMinutes(40);

        var dateTransferBregenzInnsbruckEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferBregenzInnsbruckEnd.setUTCDate(13);
        dateTransferBregenzInnsbruckEnd.setUTCHours(11);
        dateTransferBregenzInnsbruckEnd.setUTCMinutes(11);

        var dateTransferInnsbruckSalzburgStart = new Date(2017,9,10,10,45,0,0);
        dateTransferInnsbruckSalzburgStart.setUTCDate(13);
        dateTransferInnsbruckSalzburgStart.setUTCHours(13);
        dateTransferInnsbruckSalzburgStart.setUTCMinutes(14);

        var dateTransferInnsbruckSalzburgEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferInnsbruckSalzburgEnd.setUTCDate(13);
        dateTransferInnsbruckSalzburgEnd.setUTCHours(15);
        dateTransferInnsbruckSalzburgEnd.setUTCMinutes(01);

        // Beide
        var dateTransferSalzburgLinzStart = new Date(2017,9,10,10,45,0,0);
        dateTransferSalzburgLinzStart.setUTCDate(14);
        dateTransferSalzburgLinzStart.setUTCHours(6);
        dateTransferSalzburgLinzStart.setUTCMinutes(52);

        var dateTransferSalzburgLinzEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferSalzburgLinzEnd.setUTCDate(14);
        dateTransferSalzburgLinzEnd.setUTCHours(8);
        dateTransferSalzburgLinzEnd.setUTCMinutes(0);

        var dateTransferLinzStPoeltenStart = new Date(2017,9,10,10,45,0,0);
        dateTransferLinzStPoeltenStart.setUTCDate(14);
        dateTransferLinzStPoeltenStart.setUTCHours(10);
        dateTransferLinzStPoeltenStart.setUTCMinutes(1);

        var dateTransferLinzStPoeltenEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferLinzStPoeltenEnd.setUTCDate(14);
        dateTransferLinzStPoeltenEnd.setUTCHours(10);
        dateTransferLinzStPoeltenEnd.setUTCMinutes(57);

        var dateTransferStPoeltenWienStart = new Date(2017,9,10,10,45,0,0);
        dateTransferStPoeltenWienStart.setUTCDate(14);
        dateTransferStPoeltenWienStart.setUTCHours(11);
        dateTransferStPoeltenWienStart.setUTCMinutes(0);

        var dateTransferStPoeltenWienEnd = new Date(2017,9,10,10,45,0,0);
        dateTransferStPoeltenWienEnd.setUTCDate(14);
        dateTransferStPoeltenWienEnd.setUTCHours(11);
        dateTransferStPoeltenWienEnd.setUTCMinutes(20);

        var dateFarFuture = new Date(2020,9,10,10,45,0,0);
        dateFarFuture.setUTCDate(10);
        dateFarFuture.setUTCHours(12);
        dateFarFuture.setUTCMinutes(24);


        var markerStrolz = new google.maps.Marker({
            icon: imageStrolz,
            optimized: false,
            zIndex: 999998
        });

        var markerGriss = new google.maps.Marker({
            icon: imageGriss,
            optimized: false,
            zIndex: 999999
        });

        var markerGrissStrolz = new google.maps.Marker({
            icon: imageGrissStrolz,
            optimized: false,
            zIndex: 999999
        });

        var tourOverlay = new google.maps.OverlayView();
        tourOverlay.draw = function () {
            this.getPanes().markerLayer.id='markerLayer';
        };
        tourOverlay.setMap(map);


        var tourRoutes = [

            ////////////////////////////////////////////// GRISS
            // Griss startet in Wien
            {
                marker: markerGrissStrolz,
                startPosition: position_wien.position,
                startDate: dateStart,
                endPosition: position_wien.position,
                endDate: dateTransferWienGrazStart
            },
            // Griss: Wien nach Graz
            {
                marker: markerGriss,
                startPosition: position_wien.position,
                startDate: dateTransferWienGrazStart,
                endPosition: position_graz.position,
                endDate: dateTransferWienGrazEnd
            },
            // Griss: Graz
            {
                marker: markerGriss,
                startPosition: position_graz.position,
                startDate: dateTransferWienGrazEnd,
                endPosition: position_graz.position,
                endDate: dateTransferGrazSalzburgStart
            },
            // Griss: Graz nach Salzburg
            {
                marker: markerGriss,
                startPosition: position_graz.position,
                startDate: dateTransferGrazSalzburgStart,
                endPosition: position_salzburg.position,
                endDate: dateTransferGrazSalzburgEnd
            },
            // Griss in Salzburg bis Strolz eintrifft
            {
                marker: markerGriss,
                startPosition: position_salzburg.position,
                startDate: dateTransferGrazSalzburgEnd,
                endPosition: position_salzburg.position,
                endDate: dateTransferInnsbruckSalzburgEnd
            },
            ////////////////////////////////////////////// STROLZ
            //Strolz startet in Wien
            {
                marker: markerStrolz,
                startPosition: position_wien.position,
                startDate: dateTransferWienGrazStart,
                endPosition: position_wien.position,
                endDate: dateTransferBregenzInnsbruckStart
            },
            //Strolz: Wien nach Begrenz
            {
                marker: markerStrolz,
                startPosition: position_wien.position,
                startDate: dateTransferWienBregenzStart,
                endPosition: position_bregenz.position,
                endDate: dateTransferWienBregenzEnd
            },
            //Strolz: Bregenz
            {
                marker: markerStrolz,
                startPosition: position_bregenz.position,
                startDate: dateTransferWienBregenzEnd,
                endPosition: position_bregenz.position,
                endDate: dateTransferBregenzInnsbruckStart
            },
            // Strolz: Bregenz nach Innsbruck
            {
                marker: markerStrolz,
                startPosition: position_bregenz.position,
                startDate: dateTransferBregenzInnsbruckStart,
                endPosition: position_innsbruck.position,
                endDate: dateTransferBregenzInnsbruckEnd
            },
            // Strolz: Innsbruck
            {
                marker: markerStrolz,
                startPosition: position_innsbruck.position,
                startDate: dateTransferBregenzInnsbruckEnd,
                endPosition: position_innsbruck.position,
                endDate: dateTransferInnsbruckSalzburgStart
            },
            // Strolz: Innsbruck nach Salzburg
            {
                marker: markerStrolz,
                startPosition: position_innsbruck.position,
                startDate: dateTransferInnsbruckSalzburgStart,
                endPosition: position_salzburg.position,
                endDate: dateTransferInnsbruckSalzburgEnd
            },
            ////////////////////////////////////////////// BEIDE
            // Beide: Start in Salzburg
            {
                marker: markerGrissStrolz,
                startPosition: position_salzburg.position,
                startDate: dateTransferInnsbruckSalzburgEnd,
                endPosition: position_salzburg.position,
                endDate: dateTransferSalzburgLinzStart
            },
            // Beide: Salzburg nach Linz
            {
                marker: markerGrissStrolz,
                startPosition: position_salzburg.position,
                startDate: dateTransferSalzburgLinzStart,
                endPosition: position_linz.position,
                endDate: dateTransferSalzburgLinzEnd
            },
            // Beide: Linz
            {
                marker: markerGrissStrolz,
                startPosition: position_linz.position,
                startDate: dateTransferSalzburgLinzEnd,
                endPosition: position_linz.position,
                endDate: dateTransferLinzStPoeltenStart
            },
            // Beide: Linz nach St. Pölten
            {
                marker: markerGrissStrolz,
                startPosition: position_linz.position,
                startDate: dateTransferLinzStPoeltenStart,
                endPosition: position_stpoelten.position,
                endDate: dateTransferLinzStPoeltenEnd
            },
            // Beide: St. Pölten
            {
                marker: markerGrissStrolz,
                startPosition: position_stpoelten.position,
                startDate: dateTransferLinzStPoeltenEnd,
                endPosition: position_stpoelten.position,
                endDate: dateTransferStPoeltenWienStart
            },
            // Beide: St. Pölten nach Wien
            {
                marker: markerGrissStrolz,
                startPosition: position_stpoelten.position,
                startDate: dateTransferStPoeltenWienStart,
                endPosition: position_wien.position,
                endDate: dateTransferStPoeltenWienEnd
            },
            // Beide: Wien
            {
                marker: markerGrissStrolz,
                startPosition: position_wien.position,
                startDate: dateTransferStPoeltenWienEnd,
                endPosition: position_wien.position,
                endDate: dateFarFuture
            }


        ];

        //                                                                                                              Travel Marker



        var updateTravelPositions = function(wait) {

            for(var i = 0; i < tourRoutes.length; i++){
                // store a LatLng for each step of the animation
                var tourRoute = tourRoutes[i];
                var now = getNow();
                if(simulateTour){
                    $("#debug-output").html(now);
                }
                if(now > tourRoute.startDate && now < tourRoute.endDate){

                    if(tourRoute.marker.getMap() == null){
                        tourRoute.marker.setMap(map);
                    }

                    var position_source = tourRoute.startPosition;
                    var position_target = tourRoute.endPosition;

                    var duration = tourRoute.endDate - tourRoute.startDate;
                    var actual = now - tourRoute.startDate;
                    var percent = actual / duration;

                    var curLat = position_source.lat + percent * (position_target.lat - position_source.lat);
                    var curLng = position_source.lng + percent * (position_target.lng - position_source.lng);

                    tourRoute.marker.setPosition({lat:curLat, lng:curLng});

                    tourRoute.updateMeNextFrame = true;
                } else if(tourRoute.updateMeNextFrame){
                    tourRoute.marker.setMap(null);
                    tourRoute.updateMeNextFrame = false;
                }
            }

            setTimeout(function() {
                updateTravelPositions(wait);
            }, wait);
        };

        // begin animation, send back to origin after completion
        updateTravelPositions(updateInterval);

        /**/

        //                                                                                                              Routing
        /*
         var directionsService = new google.maps.DirectionsService;
         var directionsDisplay1 = new google.maps.DirectionsRenderer({map: map});
         var directionsDisplay2 = new google.maps.DirectionsRenderer({map: map});
         var directionsDisplay3 = new google.maps.DirectionsRenderer({map: map});
         var directionsDisplay4 = new google.maps.DirectionsRenderer({map: map});
         var directionsDisplay5 = new google.maps.DirectionsRenderer({map: map});
         var directionsDisplay6 = new google.maps.DirectionsRenderer({map: map});

         // Display the route between the initial start and end selections.
         window.setTimeout(function(){
         calculateAndDisplayRoute(
         directionsDisplay1, "Wien, Österreich", "Dornbirn, Österreich");

         }, 1000);

         window.setTimeout(function(){

         calculateAndDisplayRoute(
         directionsDisplay2, "Dornbirn, Österreich", "Innsbruck, Österreich");

         }, 2000);
         window.setTimeout(function(){

         calculateAndDisplayRoute(
         directionsDisplay3, "Innsbruck, Österreich", "Salzburg, Österreich");

         }, 3000);
         window.setTimeout(function(){

         calculateAndDisplayRoute(
         directionsDisplay4, "Salzburg, Österreich", "Linz, Österreich");

         }, 4000);
         window.setTimeout(function(){

         calculateAndDisplayRoute(
         directionsDisplay5, "Linz, Österreich", "Wien, Österreich");

         }, 5000);

         window.setTimeout(function(){

         calculateAndDisplayRoute(
         directionsDisplay6, "Graz, Österreich", "Salzburg, Österreich");

         }, 6000);



         function calculateAndDisplayRoute(directionsDisplay, origin, destination, waypoints) {
         // First, remove any existing markers from the map.
         for (var i = 0; i < markerArray.length; i++) {
         markerArray[i].setMap(null);
         }

         // Retrieve the start and end locations and create a DirectionsRequest using
         // WALKING directions.
         directionsService.route({
         origin: origin,
         destination: destination,
         waypoints: waypoints,
         travelMode: 'TRANSIT',
         transitOptions: {modes:["RAIL"]}
         }, function(response, status) {
         // Route the directions and pass the response to a function to create
         // markers for each step.
         if (status === 'OK') {
         response.routes[0].legs[0].steps[0].transit = null;
         directionsDisplay.setDirections(response);
         showSteps(response, markerArray, map);
         } else {
         window.alert('Directions request failed due to ' + status);
         }
         });
         }

         function showSteps(directionResult, markerArray, map) {
         // For each step, place a marker, and add the text to the marker's infowindow.
         // Also attach the marker to an array so we can keep track of it and remove it
         // when calculating new routes.
         var myRoute = directionResult.routes[0].legs[0];
         for (var i = 0; i < myRoute.steps.length; i++) {
         var marker = markerArray[i] = markerArray[i] || new google.maps.Marker;
         marker.setMap(map);
         marker.setPosition(myRoute.steps[i].start_location);
         }
         }

         */
    }

    //                                                                                                                  COUNTDOWN

    function formatted_number(number){
        return ("0" + number).slice(-2);
    }

    $(function(){
        setInterval(function(){

            date_target = new Date(); //new Date(2017 , 0, 30);
            date_target.setUTCFullYear(2017);
            date_target.setUTCMonth(9);
            date_target.setUTCDate(12);
            date_target.setUTCHours(20);
            date_target.setUTCMinutes(15);
            date_target.setUTCSeconds(0);
            date_now = getNow();
            diff_in_milliseconds = date_target - date_now;
            seconds = Math.floor(diff_in_milliseconds/1000);
            minutes = Math.floor(seconds/60);
            hours = Math.floor(minutes/60);
            days = Math.floor(hours/24);
            hours = hours - (days*24);
            minutes = minutes - days*24*60 - hours*60;
            seconds = seconds - days*24*60*60 - hours*60*60 - minutes*60;

            if(date_now < date_target){
                $("#countdown").html("<h2>" + days + ":" + formatted_number(hours) + ":" + formatted_number(minutes) + ":" + formatted_number(seconds) + "</h2>");
                $("#countdown-overlay").css("display", "table");
            }
            else {
                $("#countdown-overlay").css("display", "none");
            }
        },updateInterval);
    });
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBa-LkwNN3X8Iz9DR948QSa1k1qNzWtYS8&callback=initMap"
        async defer></script>
{{ standard_footer_includes }}
</body>
</html>